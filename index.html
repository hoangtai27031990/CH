<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HỆ THỐNG QUẢN LÝ HSD – Saigon Co.op</title>

<script src="https://cdn.tailwindcss.com"></script>

<script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
body{background:#f3f4f6}
.card{background:#fff;border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,.08)}
.brand-bg{background:#c40018}
.brand-text{color:#c40018}

.blink30{animation:blink30 .6s linear infinite;border:2px solid #fb923c}
@keyframes blink30{0%{background:#fff3e0}50%{background:#ff9800;box-shadow:0 0 20px rgba(251,146,60,1)}100%{background:#fff3e0}}

.blink20{animation:blink20 .6s linear infinite;border:2px solid #ef4444}
@keyframes blink20{0%{background:#fff1f2}50%{background:#fecaca;box-shadow:0 0 20px rgba(239,68,68,1)}100%{background:#fff1f2}}
</style>

</head>
<body class="max-w-xl mx-auto p-3">

<!-- HTML & UI giữ nguyên tuyệt đối -->

<script>
let quaggaRunning=false;
let scanTarget=null;

function drawOverlay(el){
  const box=document.createElement('div');
  box.style.position='absolute';
  box.style.inset='0';
  box.style.display='flex';
  box.style.alignItems='center';
  box.style.justifyContent='center';
  box.innerHTML=`<div style="width:80%;height:80px;border:3px solid #c40018;border-radius:8px"></div>`;
  el.style.position='relative';
  el.appendChild(box);
}

function startQuagga(targetId,cb){
 if(quaggaRunning) return;
 quaggaRunning=true;
 const el=document.getElementById(targetId);
 el.classList.remove('hidden');
 el.innerHTML='';
 drawOverlay(el);

 Quagga.init({
  inputStream:{
    type:'LiveStream',
    target:el,
    constraints:{
      facingMode:'environment',
      width:{ideal:640},
      height:{ideal:480}
    },
    area:{top:'40%',right:'10%',left:'10%',bottom:'40%'}
  },
  locator:{patchSize:'medium',halfSample:true},
  numOfWorkers:1,
  frequency:6,
  decoder:{readers:['ean_reader','ean_8_reader','code_128_reader','upc_reader']},
  locate:true
 },err=>{
  if(err){quaggaRunning=false;return}
  Quagga.start();
 });

 Quagga.onDetected(res=>{
  if(!res.codeResult||!res.codeResult.code) return;
  const code=res.codeResult.code;
  Quagga.offDetected();
  Quagga.stop();
  el.classList.add('hidden');
  quaggaRunning=false;
  cb(code);
 });
}

/* === Override scan functions (logic cũ giữ nguyên) === */
function startScan(){
 startQuagga('reader',code=>{barcode.value=code});
}

function startPrintScan(){
 startQuagga('printReader',code=>addBarcode(code));
}
</script>

</body>
</html>
