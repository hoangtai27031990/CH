<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HỆ THỐNG QUẢN LÝ HSD – Saigon Co.op</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
body{background:#f3f4f6}
.card{background:#fff;border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,.08)}
.brand-bg{background:#c40018}
.brand-text{color:#c40018}

/* ===== SCAN OVERLAY ===== */
#reader,#printReader{
  position:relative;
  width:100%;
  height:260px;
  background:#000;
}
.scan-frame{
  position:absolute;
  inset:10%;
  border:2px solid rgba(255,255,255,.4);
  z-index:10;
}
.scan-line{
  position:absolute;
  top:50%;
  left:5%;
  width:90%;
  height:4px;
  background:red;
  box-shadow:0 0 12px red;
  animation:scanMove 1.2s linear infinite;
  z-index:20;
}
@keyframes scanMove{
  0%{top:30%}
  50%{top:50%}
  100%{top:70%}
}

/* ===== BLINK ===== */
.blink30{animation:blink30 .6s linear infinite;border:2px solid #fb923c}
@keyframes blink30{0%{background:#fff3e0}50%{background:#ff9800}100%{background:#fff3e0}}
.blink20{animation:blink20 .6s linear infinite;border:2px solid #ef4444}
@keyframes blink20{0%{background:#fff1f2}50%{background:#fecaca}100%{background:#fff1f2}}

#alertPopup{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:2000}
.popup-30{border:3px solid #fb923c}
.popup-20{border:3px solid #ef4444}
</style>
</head>

<body class="max-w-xl mx-auto p-3">

<!-- POPUP -->
<div id="alertPopup" class="hidden items-center justify-center">
  <div id="popupBox">
    <div id="popupTitle" class="font-bold text-lg mb-2"></div>
    <div id="popupMsg" class="mb-4"></div>
    <button onclick="closePopup()" class="brand-bg text-white px-4 py-2 rounded">Đã hiểu</button>
  </div>
</div>

<!-- MAIN -->
<div class="card p-4 space-y-3">
<label class="font-semibold">Barcode sản phẩm</label>
<div class="flex gap-2">
<input id="barcode" class="border p-2 rounded w-full">
<button onclick="startScan()" class="brand-bg text-white px-3 rounded">Quét</button>
</div>

<div id="reader" class="hidden"></div>

<label class="font-semibold">NSX</label>
<input type="date" id="nsx" class="border p-2 rounded w-full">

<label class="font-semibold">HSD</label>
<input type="date" id="hsd" class="border p-2 rounded w-full">

<button onclick="calculate()" class="brand-bg text-white py-2 rounded">TÍNH</button>

<div id="result"></div>
</div>

<script>
const scanConfig={
  fps:6,
  aspectRatio:1.333,
  disableFlip:true,
  qrbox:{width:260,height:90},
  experimentalFeatures:{useBarCodeDetectorIfSupported:true}
};

let qr=null;

function startScan(){
  const r=document.getElementById("reader");
  r.innerHTML='<div class="scan-frame"><div class="scan-line"></div></div>';
  r.classList.remove("hidden");

  if(!qr) qr=new Html5Qrcode("reader");
  qr.start(
    {facingMode:{ideal:"environment"}},
    scanConfig,
    code=>{
      barcode.value=code;
      qr.stop().then(()=>qr.clear());
      r.classList.add("hidden");
    }
  );
}
</script>

</body>
</html>
